---
slug: configure-cd4pe
id: 5o3kmcd5aj3c
type: challenge
title: Configure Continuous Delivery for Puppet Enterprise
teaser: Set up all the necessary integrations on a brand new CD4PE instance to prepare
  it for the configuration of your pipelines.
notes:
- type: text
  contents: |-
    In this lab, you will configure the Continuous Delivery for Puppet Enterprise integrations you need to build your pipelines. You will:

     - Create a user and a workspace.
     - Configure integration with Puppet Enterprise.
     - Configure integration with source control.
     - Add a job hardware node.

     Click **Start** when you're ready to begin.
tabs:
- title: PE Console
  type: service
  hostname: puppet
  port: 443
- title: PE Server
  type: terminal
  hostname: puppet
- title: Windows Workstation
  type: service
  hostname: guac
  path: /#/client/c/workstation?username=instruqt&password=Passw0rd!
  port: 8080
- title: CD4PE-Host
  type: terminal
  hostname: cd4pe-host
- title: Gitlab
  type: terminal
  hostname: gitlab
difficulty: basic
timelimit: 3600
---
Create a Continuous Delivery user in Puppet Enterprise
========

1. Log in to the console with username `admin` and password `puppetlabs`.
1. Navigate to **Admin** > **Access Control**.
1. In the **Full name** field, enter `CD4PE User`.
1. In the **Login** field, enter `cd4pe_user`, then click **Add local user**.
1. Click the new `CD4PE User` link in the list below.
1. In the top right corner, click **Generate password reset**.
1. Copy the password reset link and paste it into a new browser tab.
1. Enter the password `puppetlabs` in the new password box and click **Reset password**.
1. Close the tab, close the password reset box, and return to the PE console.
1. Under the **User roles** tab, click **Manage roles**.
1. In the **Name** field, enter `CD4PE`. In the **Description** field, enter `CD4PE role`, and then click **Add role**.
1. Click the new `CD4PE` link in the list of roles below.
1. From the **User name** list, select `CD4PE User`, click **Add user**, and then click **Commit 1 change**.
1. Click the **Permissions** tab and add the following required permissions to the role (after selecting the options, click **Add** to set each permission):
    - **Job orchestrator:** Start, stop and view jobs.
    - **Node groups:** Create, edit, and delete child groups, All.
    - **Node groups:** View, All.
    - **Node groups:** Edit configuration data, All.
    - **Node groups:** Set environment, All.
    - **Nodes:** View node data from PuppetDB.
    - **Puppet agent:** Run Puppet on agent nodes.
    - **Puppet environment:** Deploy code, All.
    - **Puppet Server:** Compile catalogs for remote nodes.
    - **Tasks:** Run tasks, `cd4pe_jobs::run_cd4pe_job`.<br><br>
16. When finished, click **Commit 10 changes** at the bottom right.

    ðŸ”€  Switch to the PE Server tab<br><br>

17. Generate a token by running the following command at the command line:
    ```
    puppet access login
    ```
18. When prompted, enter the username `cd4pe_user` and password `puppetlabs`. Note that the password will not appear in the command line.

âœ… **Result:** The CD4PE user is created.

Configure Code Manager in Puppet Enterprise
========

1. On the PE Server tab, run the following command to create an SSH key:
    ```
    ssh-keygen -t ed25519 -C "root@puppet" -f /etc/puppetlabs/puppetserver/ssh/id_ed25519 -q -P ""
    ```

    ðŸ”€  Switch to the Windows workstation tab<br><br>

2. On the desktop, double-click the **Gitlab** browser shortcut.
3. For username, enter `puppet`. For password, enter `puppetlabs`.
    - If a **Save password** prompt appears, click either option.<br><br>
4. In the top right corner, click the circular icon dropdown and then click **Preferences**. ![drop-down button](https://storage.googleapis.com/instruqt-images/drop-down-icon.png)

5. In the icon menu at the left, click the upper key icon (for SSH keys). ![key icon](https://storage.googleapis.com/instruqt-images/key-top.png)

6. Copy the contents of the `id_rsa.pub` file generated in the first step and paste it into the **Key** text area.
    - To find the contents, return to the PE Server tab and run the following:
        ```
        cat /etc/puppetlabs/puppetserver/ssh/id_ed25519.pub
        ```
    - Note the autogenerated title and select an expiration date in the future. Click **Add key**.<br><br>
7. Navigate to **Menu** > **Projects** > **Your projects** and then click **puppet/control-repo**. ![menu projects with outlines](https://storage.cloud.google.com/instruqt-images/menu-projects-your-projects-amber.png)
8. Click the **Clone** dropdown, and then click the copy icon to the right of **Clone with SSH**. ![clone dropdown menu](https://storage.googleapis.com/instruqt-images/git-clone-amber-2.png)
 ðŸ”€ Switch to the PE Console tab<br><br>

9. Navigate to **Node groups**.
9. Click the plus (**+**) icon to the left of **PE Infrastructure** to expand the group, and then click **PE Master**.
9. Click the **Classes** tab and scroll to the bottom find the class **puppet_enterprise::profile::master**.
10. For this class, set the following (click **Add to node group** to set each parameter):<br>
    **code_manager_auto_configure**:
    ```
    true
    ```
    **r10k_remote**:
    ```
    git@gitlab:puppet/control-repo.git
    ```
    **r10k_private_key**:
    ```
    /etc/puppetlabs/puppetserver/ssh/id_ed25519
    ```
11. Click **Commit 3 changes**.

    ðŸ”€ Switch to the **PE Server** tab<br><br>

12. To configure Code Manager, run `puppet agent -t` twice. Each run should take about 1-2 minutes.

âœ… **Result:** Code Manager is configured.

Integrate CD4PE with Puppet Enterprise
========

ðŸ”€ Switch to the Windows Workstation tab

1. On the desktop, double-click the **CD4PE** shortcut.
    - If the browser window shows a connection privacy warning, bypass it by clicking **Advanced** > **Continue to cd4pe (unsafe)**.
1. From the CD4PE login screen, click **Create an account**, then enter your information (remember the username and password you enter - you will need it later on), then click **Sign Up**.
2. On the next screen, click **+ Add new workspace**. Call it **Puppet** and then click **Create workspace**.
3. You'll be logged as your new user and will arrive at your main Workspace page. Under the **Set up Continuous Delivery for PE** header at the top, notice the steps listed. You we will complete those steps next.

<u>Integrate Puppet Enterprise</u>

1. Click **Integrate Puppet Enterprise**, and then click **Add credentials**.
2. In the next window, set the following:
    - In the **Name** field, enter **Puppet Server**.
    - For the **Puppet Enterprise console address**, enter **https://puppet**.
    - Keep **Basic authorization** selected.
    - For **Puppet Enterprise username**, enter `cd4pe_user`.
    - For **Puppet Enterprise password**, enter `puppetlabs`.
3. Click **Save Changes**, and then on the confirmation screen click **Close**.
âœ… **Result:** Puppet Enterprise is integrated.

<u>Integrate source control</u>

1. Click **Integrate source control**.
1. Click **GitLab**. In the **Host** field, enter **https://gitlab/**.
1. Switch to the **GitLab** tab in your browser and select **Settings** > **Access Tokens** from the left side navigation bar.
1. Enter **CD4PE** in the **Token name** text box, choose an expiration date in the future, select **Maintainer** as the role and select all of the available scopes. Click **Create project access token**.
1. The project access token will be displayed on the next page. Click the clipboard copy icon to copy it.
1. Switch back to the **CD4PE** browser tab and paste the new token into the **Token** text box.
1. Select **Clone via HTTP(S)** and then click **Add credentials**. After the credentials have been added, click **Done**.
âœ… **Result:** Source control is integrated.

<u>Add a job hardware node</u>

1. Click **Set up job hardware**.
2. Click **+ Edit**.
3. From the **Puppet Enterprise Server** list select the server you've previously added (Puppet-Server), and then check the box to the left of the node, click **Save**, and then click **Done**.
âœ… **Result:** A job hardware node has been added.

----------

ðŸŽˆ **Congratulations!** You've configured the necessary integrations for CD4PE! If you'd like to learn how to add a control repository and configure a pipeline for CD4PE, continue to the next lab. Otherwise, spend some time exploring this environment. When you are through with this lab, click **Next**.